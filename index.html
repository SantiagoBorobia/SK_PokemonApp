<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="Grid.css">
    <link rel="stylesheet" type="text/css" href="style-index.css">
    <link rel="stylesheet" type="text/css" href="querries-index.css">

	<title>Soluciones Kuali Front-end Challenge</title>
</head>
<body onload="getAllPokemons()">
    <div id="wrapper">
        <header>
            <div class="row heading">
                <img class="logo-big" src="Images/PokemonLogo.png">
            </div>
            <div class="row intro">
                <div class="introText">
                    <h2>SK Frontend Challenge</h2>
                    <p>¡Bienvenido a esta aplicación pokémon! <br> 
                        A continuación se muestra un listado de todos los pokémon, los cuales se obtuvieron a través de la "PokéAPI". Para ver la información detallada de algún pokémon en particular, simplemente haz click en él y la aplicación te enviará a la página correspondiente.<br>
                        Explora líbremente el listado, utilizando el paginador al final del mismo o buscando por nombre o número, y conoce a todos los pokémon.<br>
                        ¡Gracias por utilizar esta aplicación!
                        
                    </p>
                </div>
                <div class="introImage">
                    <img src="Images/Pokeball.png">
                </div>
            </div>
        </header>
    
        <section class="lista" id="topList">
            <div class="row">
                <div class="buscador">
                    <ion-icon name="search-outline"></ion-icon><input id="finder" placeholder="Buscar..." onchange="buscarPokemon()">
                    <button class="btn" onclick="limpiarBusqueda()">Limpiar búsqueda</button>
                    <br>
                    <br>
                    <a class="ordenador" onclick="changeOrder()" id="order">Ordenar lista por nombre (A-Z)</a>
                </div>
            </div>
            
            <div class="row">
                <div class="pokemonBox" id="poke1" onclick="selectPokemon(1)">
                    
                </div>
                
                <div class="pokemonBox" id="poke2" onclick="selectPokemon(2)">
                    
                </div>
                
                <div class="pokemonBox" id="poke3" onclick="selectPokemon(3)">
                    
                </div>
                
                <div class="pokemonBox" id="poke4" onclick="selectPokemon(4)">
                    
                </div>
            </div>
            
            <div class="row">
                <div class="pokemonBox" id="poke5" onclick="selectPokemon(5)">
                    
                </div>
                
                <div class="pokemonBox" id="poke6" onclick="selectPokemon(6)">
                    
                </div>
                
                <div class="pokemonBox" id="poke7" onclick="selectPokemon(7)">
                    
                </div>
                
                <div class="pokemonBox" id="poke8" onclick="selectPokemon(8)">
                    
                </div>
            </div>
            
            <div class="row">
                <div class="pokemonBox" id="poke9" onclick="selectPokemon(9)">
                    
                </div>
                
                <div class="pokemonBox" id="poke10" onclick="selectPokemon(10)">
                    
                </div>
                
                <div class="pokemonBox" id="poke11" onclick="selectPokemon(11)">
                    
                </div>
                
                <div class="pokemonBox" id="poke12" onclick="selectPokemon(12)">
                    
                </div>
            </div>
    
            <div class="row">
                <div class="pokemonBox" id="poke13" onclick="selectPokemon(13)">
                    
                </div>
                
                <div class="pokemonBox" id="poke14" onclick="selectPokemon(14)">
                    
                </div>
                
                <div class="pokemonBox" id="poke15" onclick="selectPokemon(15)">
                    
                </div>
                
                <div class="pokemonBox" id="poke16" onclick="selectPokemon(16)">
                    
                </div>
            </div>
                
            <div class="row">
                <div class="pokemonBox" id="poke17" onclick="selectPokemon(17)">
                    
                </div>
                
                <div class="pokemonBox" id="poke18" onclick="selectPokemon(18)">
                    
                </div>
                
                <div class="pokemonBox" id="poke19" onclick="selectPokemon(19)">
                    
                </div>
                
                <div class="pokemonBox" id="poke20" onclick="selectPokemon(20)">
                    
                </div>
            </div>
            
            <div class="row">
                <div class="pokemonBox" id="poke21" onclick="selectPokemon(21)">
                    
                </div>
                
                <div class="pokemonBox" id="poke22" onclick="selectPokemon(22)">
                    
                </div>
                
                <div class="pokemonBox" id="poke23" onclick="selectPokemon(23)">
                    
                </div>
                
                <div class="pokemonBox" id="poke24" onclick="selectPokemon(24)">
                    
                </div>
            </div>
            
            <div class="row">
                <ul class="paginador">
                    <li id="Prev"><a href="#topList"><ion-icon name="chevron-back-outline" onclick="paginadorLeft()"></ion-icon></a></li>
                    <li onclick="selectPage(1)"><a id="p1" href="#topList">1</a></li>
                    <li onclick="selectPage(2)"><a id="p2" href="#topList">2</a></li>
                    <li onclick="selectPage(3)"><a id="p3" href="#topList">3</a></li>
                    <li onclick="selectPage(4)"><a id="p4" href="#topList">4</a></li>
                    <li onclick="selectPage(5)"><a id="p5" href="#topList">5</a></li>
                    <li onclick="selectPage(6)"><a id="p6" href="#topList">6</a></li>
                    <li onclick="selectPage(7)"><a id="p7" href="#topList">7</a></li>
                    <li onclick="selectPage(8)"><a id="p8" href="#topList">8</a></li>
                    <li onclick="selectPage(9)"><a id="p9" href="#topList">9</a></li>
                    <li onclick="selectPage(10)"><a id="p10" href="#topList">10</a></li>
                    <li id="Next"><a href="#topList"><ion-icon name="chevron-forward-outline" onclick="paginadorRight()"></ion-icon></a></li>
                </ul>
            </div>
            <div class="row">
                <p id="actPage">Página 1/36 </p>
            </div>
        </section>
        
        <footer>
            <div class="row">
                <img src="Images/Pokeball-Icon.png">
            </div>
            <div class="row">
                <p>Santiago Borobia Rodríguez</p>
            </div>
            <div class="row">
                <p>santiagoborobia1@hotmail.com</p> 
            </div>
        </footer>
    
    </div>
        
    <script src="https://unpkg.com/ionicons@5.2.3/dist/ionicons.js"></script>
</body>

    
<!--
    JavaScript functionality
-->    
<script>
    
//*****************************
//    LLENADO DE TABLA
//*****************************
    
    var pokeIds = 1; //id del pokemon que aparece primero en la lista.
    var cons = true; //variable para ver si logro realizar el fetch a la pokeApi
    var names = [];
    var orderID = true;
    
    async function getAllPokemons(){
        var urlPokes = "https://pokeapi.co/api/v2/pokemon?limit=893&offset=0";
        var pokes = await new Promise(function(resolve, reject) {
            fetch(urlPokes).then(
                (response)=> {
                    response.json().then(
                        (pokemons)=> {
                            resolve(pokemons);
                        }
                    );  
                },
                (error)=> {reject(error);}
            );
        });
        
        
        for(var i=0; i<893; i++){
            names.push(pokes.results[i].name);
        }
        names.sort();
        fillTable();
    }
    
    function changeOrder(){
        if(orderID==true){
            document.getElementById("order").innerHTML = "Ordenar lista por ID";
            orderID=false;
        }
        else{
            document.getElementById("order").innerHTML = "Ordenar lista por nombre (A-Z)";
            orderID=true;
        }
        
        pokeIds=1;
        fillTable();
    }
    
	async function fillTable(){
        var row = 1;
        cons = true;
        var poke = pokeIds;
        
        if(orderID){
            while(cons && row<=24 && poke<894){
                consultPokemon(poke, row);
                row = row + 1;
                poke = poke+1;
            }
            pokeIds=poke;
        }
        else{
            while(cons && row<=24 && poke<894){
                consultPokemon(names[poke-1], row);
                row = row + 1;
                poke = poke+1;
            }
            pokeIds=poke;
        }
        
	}
    
    async function buscarPokemon(){
        var pokemon = document.getElementById("finder").value;
        
        if(pokemon != ""){
            for(var i=1; i<25; i++){
                document.getElementById("poke"+i).innerHTML="";
            }
            consultPokemon(pokemon.toLowerCase(),1);
        }
    }
    
    function limpiarBusqueda(){
        document.getElementById("finder").value = "";
        pokeIds=1;
        fillTable();
    }
    
    async function consultPokemon(id, row){
        var urlPoke = "https://pokeapi.co/api/v2/pokemon/"+id;
        var poke = await new Promise(function(resolve, reject) {
            fetch(urlPoke).then(
                (response)=> {
                    if(response.ok){
                        response.json().then(
                            (pokemon)=> {
                                resolve(pokemon);
                            }
                        );  
                    }
                    else{
                        resolve(null);
                    }
                    
                },
                (error)=> {reject(error);}
            );
        });
                
        createPokemon(poke, row);
    }
    
    async function createPokemon(pokemon, row){
        
        if(pokemon != null){
            var pokemonNumber = pokemon.id;
            var pokemonId;
            if(Math.trunc(pokemonNumber/100)==0){
                if(Math.trunc(pokemonNumber/10)==0){
                    pokemonId="00"+pokemonNumber;
                }
                else{
                    pokemonId="0"+pokemonNumber;
                }
            }
            else{
                pokemonId=pokemonNumber;
            }
            var strHTML =   "<div class='row'>"+
                                "<img id='pokeImg"+row+"' src='"+pokemon.sprites.front_default+"'>"+
                            "</div>"+
                            "<div class='row'>"+
                                "<p id='pokeName"+row+"' class='pokeName'>"+pokemon.name+"</p>"+
                            "</div>"+
                            "<div class='row'>"+
                                "<p id='pokeId"+row+"' class='pokeNumber'>No. "+pokemonId+"</p>"+
                            "</div>";

            
        }
        else{
            var strHTML = "<div class='row'>"+
                                "<p id='pokeName"+row+"' class='pokeName'>El pokémon buscado no existe</p>"+
                            "</div>";
        }
        
        var strRow = "poke"+row;
        document.getElementById(strRow).innerHTML = strHTML;
    }
    
//*****************************
//   FUNCIONALIDAD PAGINADOR
//*****************************
    
    var pag = 0; // pagina actual del paginador (Hay 38 paginas en total)
    var pagIndex = 1; // posicion del elemento del paginador que estara subrayado (va de 1-10)
    var pagSection = 1; //conjunto de 10 numeros de pagina (va de 1 a 4)
    var sectionChange=false;
    
    function paginadorLeft(){
        pag--;
        pagIndex--;
        
        if(pag==0){
            document.getElementById("Prev").style.display = "none"; //Esconde flecha hacia atras
        }
        
        if(pag==36){
            document.getElementById("Next").style.display = "inline-block"; //Muestra flecha hacia adelante
        }
        
        if((pag+1)==10 || (pag+1)==20 || (pag+1)==30){
            pagSection--;
            setPagSection();
            pagIndex=10;
            sectionChange=true;
        }
        
        if(!sectionChange){
            document.getElementById("p"+(pagIndex)).style = "text-decoration: underline"; //Subraya pag actual
            document.getElementById("p"+(pagIndex+1)).style = "text-decoration: none"; //Quita subrayado de pag previamente seleccionada.
        }
        else{
            document.getElementById("p10").style = "text-decoration: underline"; 
            document.getElementById("p1").style = "text-decoration: none"; 
            sectionChange=false;
        }
        
        document.getElementById("actPage").innerHTML = "Página "+(pag+1)+"/38"; //Coloca el numero de pagina actual.
        
        pokeIds=pag*24+1; //Llena la tabla con los pokemones indicados.
        fillTable();
    }
    
    function paginadorRight(){
        
        pag++;
        pagIndex++;
        
        if(pag==1){
           document.getElementById("Prev").style.display = "inline-block"; //Muestra flecha hacia atras 
        }
        
        if(pag==37){
            document.getElementById("Next").style.display = "none"; //Esconde flecha hacia adelante 
            var i;
            for(i=5; i<25; i++){
                document.getElementById("poke"+i).innerHTML="";
            }
        }
        
        if((pag-1)==9 || (pag-1)==19 || (pag-1)==29){
            pagSection++;
            setPagSection();
            pagIndex=1;
            sectionChange=true;
        }
        
        if(!sectionChange){
            document.getElementById("p"+(pagIndex)).style = "text-decoration: underline"; //Subraya pag actual
            document.getElementById("p"+(pagIndex-1)).style = "text-decoration: none"; //Quita subrayado de pag previamente seleccionada. 
        }
        else{
            document.getElementById("p1").style = "text-decoration: underline"; 
            document.getElementById("p10").style = "text-decoration: none";  
            sectionChange=false;
        }
        
        
        document.getElementById("actPage").innerHTML= "Página "+(pag+1)+"/38";
        fillTable();
    }
    
    function setPagSection(){
        var first;
        var last;
        switch(pagSection){
            case 1:
                first = 1;
                last = 10;
                break;
            case 2:
                first = 11;
                last = 10;
                break;
            case 3:
                first = 21;
                last = 10;
                break;
            case 4:
                first = 31;
                last = 8;
                document.getElementById("p9").innerHTML = "";
                document.getElementById("p10").innerHTML = "";
                break;
        }
        var j= first;
        for(var i=1; i<=last; i++){
            document.getElementById("p"+(i)).innerHTML = j;
            j++;
        }
    }
    
    function selectPage(selPage){
        var page = document.getElementById("p"+selPage).innerHTML;
        
        for(var i=1; i<=10; i++){
            document.getElementById("p"+(i)).style = "text-decoration: none";
        }
        document.getElementById("p"+(selPage)).style = "text-decoration: underline";
        
        if(page>=1 && page<=10){
            pagSection = 1;
        }
        else{
            if(page>=11 && page<=20){
                pagSection=2;
            }
            else{
                if(page>=21 && page<=30){
                    pagSection=3;
                }
                else{
                    pagSection=4;
                }
            }
        }
        setPagSection();
        pagIndex=selPage;
        if(page==1){
            document.getElementById("Prev").style="display:none";
        }
        else{
            if(page==38){
                document.getElementById("Next").style="display:none";
                var i;
                for(i=5; i<25; i++){
                    document.getElementById("poke"+i).innerHTML="";
                }
            }
            else{
                document.getElementById("Prev").style="display:inline-block";
                document.getElementById("Next").style="display:inline-block";
            }
        }
        document.getElementById("actPage").innerHTML= "Página "+(page)+"/38";
        
        pag = page-1;
        pokeIds=pag*24+1; //Llena la tabla con los pokemones indicados.
        fillTable();
    }
    
//*****************************
//   SELECCION DE POKEMON
//*****************************
    
    //Obtiene el id del pokemon seleccionado y lo guarda en una "session"
    // y la envia a la ruta dedicada para la informacion del pokemon.
    function selectPokemon(row){
        var id = document.getElementById("pokeId"+row).innerHTML;
        id = parseInt(id.substring(4));
        sessionStorage.setItem("pokeId", id);
        window.location.href = "pokemonInfo.html";
    }
    
    

</script>

    
</html>